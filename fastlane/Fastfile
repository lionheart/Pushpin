# vim: set ft=ruby:

fastlane_version "2.28.1"
xcode_select "/Applications/Xcode 9 GM.app"
default_platform :ios

platform :ios do
  lane :beta do
    gym
    deliver
  end

  lane :appstore do
    ensure_git_status_clean
    increment_build_number(xcodeproj: "Pushpin.xcodeproj")

    gym

    ENV["SCHEME"] = "Pushpin"
    # snapshot
    deliver

    version_number = get_version_number(xcodeproj: "Pushpin.xcodeproj", target: "Pushpin")
    build_number = get_build_number(xcodeproj: "Pushpin.xcodeproj")
    commit_version_bump(message: "bump to #{build_number}", xcodeproj: "./Pushpin.xcodeproj")
    add_git_tag tag: "v#{version_number}+#{build_number}"
    push_to_git_remote
  end
end
